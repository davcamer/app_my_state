<html>
<head>
  <title>Google maps example</title>

  <style>
    #map {width:600px;height:400px;}
    #categories {float:right;}
    #category_list {border: 2px solid #000;}
    #category_list ul {list-style: none inside;}
    #category_list li {list-style-type: none; margin: 5px;}
  </style>
  
    <script src="http://maps.google.com/maps/api/js?sensor=false"></script>
    <script src="/javascripts/markermanager_packed.js"></script>
    <script src="/javascripts/markerclusterer_packed.js"></script>
    <script src="/javascripts/data.js"></script>
    <script src="/javascripts/jquery-1.4.2.js"></script>

    <script type="text/javascript">
        function createMarker(map,point,iconUrl) {
            return new google.maps.Marker({  
                position: point,
                icon: iconUrl
            });
        }

        function toggleMarkers(event) {
            var mgr = event.data;
            if (this.checked) {
              mgr.show();
            } else {
              mgr.hide();
            }
        }

        function setupCategory(mgr, data, minZoom, iconUrl) {
            var i = data.length;
            while (i--) {
              var item = data[i];
              var point = new google.maps.LatLng(item.latitude, item.longitude);
              var marker = createMarker(map,point,iconUrl);
              mgr.addMarker(marker, minZoom);
            }
        }

//        var geocoder = new GClientGeocoder();
//        geocoder.setBaseCountryCode("au");
//        var northeast_limit = new GLatLng(-37.80,145.0);
//        var southwest_limit = new GLatLng(-37.85,144.9);
//        geocoder.setViewport(new GLatLngBounds(southwest_limit, northeast_limit));
//        function showAddress(event) {
//          var map = event.data.map;
//          var address = event.data.input.val();
//          geocoder.getLatLng(
//            address,
//            function(point) {
//              if (!point) {
//                alert(address + " not found");
//              } else {
//                map.setCenter(point, 13);
//              }
//            }
//          );
//        }

        function setupMap() {
            var options = {
                zoom: 14,
                center: new google.maps.LatLng(-37.8062649904, 144.96165842),
                mapTypeId: google.maps.MapTypeId.HYBRID
            };
            var map = new google.maps.Map(document.getElementById("map"), options);

            google.maps.event.addListenerOnce(map, 'bounds_changed', function(){
                setupMarkers(map);
            });
        }

        function createMarkerList(data, iconUrl, map) {
            var markers = new Array();
            var i = data.length;
            while (i--) {
              var item = data[i];
              var point = new google.maps.LatLng(item.latitude, item.longitude);
              var marker = createMarker(map,point,iconUrl);
              markers.push(marker);
            }
            return markers;
        }

        function setupMarkers(map) {
            var trough = new MarkerClusterer(map, createMarkerList(Horse_Trough, 'http://google-maps-icons.googlecode.com/files/horseriding.png', map, {zoomOnClick: true}));
            var bin = new MarkerClusterer(map, createMarkerList(Litter_Bin, 'http://google-maps-icons.googlecode.com/files/trash.png', map, {zoomOnClick: true}));
            var info = new MarkerClusterer(map, createMarkerList(Information_Pillar, 'http://google-maps-icons.googlecode.com/files/info.png', map, {zoomOnClick: true}));
            var seat = new MarkerClusterer(map, createMarkerList(Seat, 'http://google-maps-icons.googlecode.com/files/bench.png', map, {zoomOnClick: true}));
            var drink = new MarkerClusterer(map, createMarkerList(Drinking_Fountain, 'http://google-maps-icons.googlecode.com/files/drinkingfountain.png', map, {zoomOnClick: true}));
            var picnic = new MarkerClusterer(map, createMarkerList(Picnic_Setting, 'http://google-maps-icons.googlecode.com/files/picnic.png', map, {zoomOnClick: true}));
            var rails = new MarkerClusterer(map, createMarkerList(Bicycle_Rails.concat(Hoop), 'http://google-maps-icons.googlecode.com/files/bicycleparking.png', map, {zoomOnClick: true}));
            var corral = new MarkerClusterer(map, createMarkerList(Bin_Corral, 'http://google-maps-icons.googlecode.com/files/trash.png', map, {zoomOnClick: true}));
            var equip = new MarkerClusterer(map, createMarkerList(Recreation_Equipment_Item, 'http://google-maps-icons.googlecode.com/files/basketball.png', map, {zoomOnClick: true}));
            var bbq = new MarkerClusterer(map, createMarkerList(Barbeque, 'http://google-maps-icons.googlecode.com/files/restaurant-barbecue.png', map, {zoomOnClick: true}));

        }

        function initialize() {
            setupMap();

//            var address_input = $("#address_form input[name='address']");
//            $("#address_form input[name='address_submit']")
//                    .bind("click", {map: map, input: address_input}, showAddress);
        }


        $(initialize);
    </script>

</head>
<body>
<div id="container">
Here's the map:
<!-- This is the element in which the map will be displayed. -->
<div id="categories">
  <form name="category_toggles">
    <ul id="category_list">
      <li><label><input type="checkbox" name="trough" checked="true">Horse Troughs</label></li>
      <li><label><input type="checkbox" name="bin" checked="true">Rubbish Bins</label></li>
      <li><label><input type="checkbox" name="info" checked="true">Information Pillars</label></li>
      <li><label><input type="checkbox" name="seat" checked="true">Seats</label></li>
      <li><label><input type="checkbox" name="drink" checked="true">Drinking Fountains</label></li>
      <li><label><input type="checkbox" name="picnic" checked="true">Picnic Settings</label></li>
      <li><label><input type="checkbox" name="rails" checked="true">Bicycle Parking</label></li>
      <li><label><input type="checkbox" name="corral" checked="true">Bin Corrals</label></li>
      <li><label><input type="checkbox" name="equip" checked="true">Recreation Equipment Item</label></li>
      <li><label><input type="checkbox" name="bbq" checked="true">Barbeque</label></li>
    </ul>
  </form>
</div>
<div id="map"></div>
<div id="address_form">
  <label for="address">Centre on address: </label>
  <input type="text" name="address" id="address">
  <input type="submit" name="address_submit">
</div>
</div>
</body>
</html>